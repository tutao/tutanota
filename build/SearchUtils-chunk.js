import { assertMainOrNode } from "./Env-chunk.js";
import { mithril_default } from "./mithril-chunk.js";
import { assertNotNull, base64ToBase64Url, base64UrlToBase64, decodeBase64, filterInt, getDayShifted, getEndOfDay, getStartOfDay, incrementMonth, isSameTypeRef, stringToBase64 } from "./dist2-chunk.js";
import { LEGACY_BCC_RECIPIENTS_ID, LEGACY_BODY_ID, LEGACY_CC_RECIPIENTS_ID, LEGACY_TO_RECIPIENTS_ID, getElementId } from "./EntityUtils-chunk.js";
import { typeModels } from "./TypeModels-chunk.js";
import { CalendarEventTypeRef, ContactTypeRef, MailTypeRef } from "./TypeRefs-chunk.js";
import { locator } from "./CommonLocator-chunk.js";
import { throttleRoute } from "./RouteChange-chunk.js";

//#region src/mail-app/search/model/SearchUtils.ts
assertMainOrNode();
const FIXED_FREE_SEARCH_DAYS = 28;
let SearchCategoryTypes = function(SearchCategoryTypes$1) {
	SearchCategoryTypes$1["mail"] = "mail";
	SearchCategoryTypes$1["contact"] = "contact";
	SearchCategoryTypes$1["calendar"] = "calendar";
	return SearchCategoryTypes$1;
}({});
const SEARCH_CATEGORIES = [
	{
		name: SearchCategoryTypes.mail,
		typeRef: MailTypeRef
	},
	{
		name: SearchCategoryTypes.contact,
		typeRef: ContactTypeRef
	},
	{
		name: SearchCategoryTypes.calendar,
		typeRef: CalendarEventTypeRef
	}
];
function getSearchType(category) {
	return assertNotNull(SEARCH_CATEGORIES.find((c) => c.name === category)).typeRef;
}
const SEARCH_MAIL_FIELDS = [
	{
		textId: "all_label",
		field: null,
		attributeIds: null
	},
	{
		textId: "subject_label",
		field: "subject",
		attributeIds: [typeModels.Mail.values["subject"].id]
	},
	{
		textId: "mailBody_label",
		field: "body",
		attributeIds: [LEGACY_BODY_ID]
	},
	{
		textId: "from_label",
		field: "from",
		attributeIds: [typeModels.Mail.associations["sender"].id]
	},
	{
		textId: "to_label",
		field: "to",
		attributeIds: [
			LEGACY_TO_RECIPIENTS_ID,
			LEGACY_CC_RECIPIENTS_ID,
			LEGACY_BCC_RECIPIENTS_ID
		]
	},
	{
		textId: "attachmentName_label",
		field: "attachment",
		attributeIds: [typeModels.Mail.associations["attachments"].id]
	}
];
const routeSetThrottled = throttleRoute();
function searchCategoryForRestriction(restriction) {
	return assertNotNull(SEARCH_CATEGORIES.find((c) => isSameTypeRef(c.typeRef, restriction.type))).name;
}
function getSearchUrl(query, restriction, selectionKey = null) {
	const { path, params } = getSearchParameters(query, restriction, selectionKey);
	return mithril_default.buildPathname(path, params);
}
function getSearchParameters(query, restriction, selectionKey) {
	const category = searchCategoryForRestriction(restriction);
	const params = {
		query: query ?? "",
		category
	};
	if (restriction.start) params.start = restriction.start;
	if (restriction.end) params.end = restriction.end;
	if (restriction.folderIds.length > 0) params.folder = restriction.folderIds;
	if (restriction.field) params.field = restriction.field;
	if (restriction.eventSeries != null) params.eventSeries = String(restriction.eventSeries);
	return {
		path: "/search/:category" + (selectionKey ? "/" + selectionKey : ""),
		params
	};
}
function getFreeSearchStartDate() {
	return getStartOfDay(getDayShifted(new Date(), -FIXED_FREE_SEARCH_DAYS));
}
function createRestriction(searchCategory, start, end, field, folderIds, eventSeries) {
	if (locator.logins.getUserController().isFreeAccount() && searchCategory === SearchCategoryTypes.mail) {
		start = null;
		end = getFreeSearchStartDate().getTime();
		field = null;
		folderIds = [];
		eventSeries = null;
	}
	let r = {
		type: getSearchType(searchCategory),
		start,
		end,
		field: null,
		attributeIds: null,
		folderIds,
		eventSeries
	};
	if (!field) return r;
	if (searchCategory === SearchCategoryTypes.mail) {
		let fieldData = SEARCH_MAIL_FIELDS.find((f) => f.field === field);
		if (fieldData) {
			r.field = field;
			r.attributeIds = fieldData.attributeIds;
		}
	} else if (searchCategory === SearchCategoryTypes.contact) {} else if (searchCategory === SearchCategoryTypes.calendar) {
		if (field === "recipient") {
			r.field = field;
			r.attributeIds = [
				typeModels.Contact.values["firstName"].id,
				typeModels.Contact.values["lastName"].id,
				typeModels.Contact.associations["mailAddresses"].id
			];
		} else if (field === "mailAddress") {
			r.field = field;
			r.attributeIds = [typeModels.Contact.associations["mailAddresses"].id];
		}
	}
	return r;
}
function getRestriction(route) {
	let category;
	let start = null;
	let end = null;
	let field = null;
	let folderIds = [];
	let eventSeries = null;
	if (route.startsWith("/mail") || route.startsWith("/search/mail")) {
		category = SearchCategoryTypes.mail;
		if (route.startsWith("/search/mail")) try {
			const { params } = mithril_default.parsePathname(route);
			if (typeof params["start"] === "string") start = filterInt(params["start"]);
			if (typeof params["end"] === "string") end = filterInt(params["end"]);
			if (typeof params["field"] === "string") {
				const fieldString = params["field"];
				field = SEARCH_MAIL_FIELDS.find((f) => f.field === fieldString)?.field ?? null;
			}
			if (Array.isArray(params["folder"])) folderIds = params["folder"];
		} catch (e) {
			console.log("invalid query: " + route, e);
		}
	} else if (route.startsWith("/contact") || route.startsWith("/search/contact")) category = SearchCategoryTypes.contact;
else if (route.startsWith("/calendar") || route.startsWith("/search/calendar")) {
		const { params } = mithril_default.parsePathname(route);
		try {
			if (typeof params["eventSeries"] === "boolean") eventSeries = params["eventSeries"];
			if (typeof params["start"] === "string") start = filterInt(params["start"]);
			if (typeof params["end"] === "string") end = filterInt(params["end"]);
			const folder = params["folder"];
			if (Array.isArray(folder)) folderIds = folder;
		} catch (e) {
			console.log("invalid query: " + route, e);
		}
		category = SearchCategoryTypes.calendar;
		if (start == null || locator.logins.getUserController().isFreeAccount()) {
			const now = new Date();
			now.setDate(1);
			start = getStartOfDay(now).getTime();
		}
		if (end == null || locator.logins.getUserController().isFreeAccount()) {
			const endDate = incrementMonth(new Date(start), 3);
			endDate.setDate(0);
			end = getEndOfDay(endDate).getTime();
		}
	} else throw new Error("invalid type " + route);
	return createRestriction(category, start, end, field, folderIds, eventSeries);
}
function decodeCalendarSearchKey(searchKey) {
	return JSON.parse(decodeBase64("utf-8", base64UrlToBase64(searchKey)));
}
function encodeCalendarSearchKey(event) {
	const eventStartTime = event.startTime.getTime();
	return base64ToBase64Url(stringToBase64(JSON.stringify({
		start: eventStartTime,
		id: getElementId(event)
	})));
}

//#endregion
export { SEARCH_MAIL_FIELDS, SearchCategoryTypes, createRestriction, decodeCalendarSearchKey, encodeCalendarSearchKey, getFreeSearchStartDate, getRestriction, getSearchParameters, getSearchType, getSearchUrl, searchCategoryForRestriction };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VhcmNoVXRpbHMtY2h1bmsuanMiLCJuYW1lcyI6WyJjYXRlZ29yeTogc3RyaW5nIiwiU0VBUkNIX01BSUxfRklFTERTOiBSZWFkb25seUFycmF5PFNlYXJjaE1haWxGaWVsZD4iLCJyb3V0ZVNldFRocm90dGxlZDogUm91dGVTZXRGbiIsInJlc3RyaWN0aW9uOiBTZWFyY2hSZXN0cmljdGlvbiIsInF1ZXJ5OiBzdHJpbmcgfCBudWxsIiwic2VsZWN0aW9uS2V5OiBzdHJpbmcgfCBudWxsIiwicGFyYW1zOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCBudW1iZXIgfCBBcnJheTxzdHJpbmc+PiIsInNlYXJjaENhdGVnb3J5OiBTZWFyY2hDYXRlZ29yeVR5cGVzIiwic3RhcnQ6IG51bWJlciB8IG51bGwiLCJlbmQ6IG51bWJlciB8IG51bGwiLCJmaWVsZDogc3RyaW5nIHwgbnVsbCIsImZvbGRlcklkczogQXJyYXk8c3RyaW5nPiIsImV2ZW50U2VyaWVzOiBib29sZWFuIHwgbnVsbCIsInI6IFNlYXJjaFJlc3RyaWN0aW9uIiwicm91dGU6IHN0cmluZyIsImNhdGVnb3J5OiBTZWFyY2hDYXRlZ29yeVR5cGVzIiwic2VhcmNoS2V5OiBzdHJpbmciLCJldmVudDogQ2FsZW5kYXJFdmVudCJdLCJzb3VyY2VzIjpbIi4uL3NyYy9tYWlsLWFwcC9zZWFyY2gvbW9kZWwvU2VhcmNoVXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG0gZnJvbSBcIm1pdGhyaWxcIlxuaW1wb3J0IHtcblx0YXNzZXJ0Tm90TnVsbCxcblx0YmFzZTY0VG9CYXNlNjRVcmwsXG5cdGJhc2U2NFVybFRvQmFzZTY0LFxuXHRkZWNvZGVCYXNlNjQsXG5cdGZpbHRlckludCxcblx0Z2V0RGF5U2hpZnRlZCxcblx0Z2V0RW5kT2ZEYXksXG5cdGdldFN0YXJ0T2ZEYXksXG5cdGluY3JlbWVudE1vbnRoLFxuXHRpc1NhbWVUeXBlUmVmLFxuXHRzdHJpbmdUb0Jhc2U2NCxcblx0VHlwZVJlZixcbn0gZnJvbSBcIkB0dXRhby90dXRhbm90YS11dGlsc1wiXG5pbXBvcnQgeyBSb3V0ZVNldEZuLCB0aHJvdHRsZVJvdXRlIH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9taXNjL1JvdXRlQ2hhbmdlXCJcbmltcG9ydCB7IFNlYXJjaFJlc3RyaWN0aW9uIH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9hcGkvd29ya2VyL3NlYXJjaC9TZWFyY2hUeXBlc1wiXG5pbXBvcnQgeyBhc3NlcnRNYWluT3JOb2RlIH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9hcGkvY29tbW9uL0VudlwiXG5pbXBvcnQgeyBUcmFuc2xhdGlvbktleSB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vbWlzYy9MYW5ndWFnZVZpZXdNb2RlbFwiXG5pbXBvcnQgeyBDYWxlbmRhckV2ZW50LCBDYWxlbmRhckV2ZW50VHlwZVJlZiwgQ29udGFjdCwgQ29udGFjdFR5cGVSZWYsIE1haWwsIE1haWxUeXBlUmVmIH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9hcGkvZW50aXRpZXMvdHV0YW5vdGEvVHlwZVJlZnNcIlxuaW1wb3J0IHsgdHlwZU1vZGVscyB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vYXBpL2VudGl0aWVzL3R1dGFub3RhL1R5cGVNb2RlbHMuanNcIlxuaW1wb3J0IHsgbG9jYXRvciB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vYXBpL21haW4vQ29tbW9uTG9jYXRvci5qc1wiXG5pbXBvcnQge1xuXHRnZXRFbGVtZW50SWQsXG5cdExFR0FDWV9CQ0NfUkVDSVBJRU5UU19JRCxcblx0TEVHQUNZX0JPRFlfSUQsXG5cdExFR0FDWV9DQ19SRUNJUElFTlRTX0lELFxuXHRMRUdBQ1lfVE9fUkVDSVBJRU5UU19JRCxcbn0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9hcGkvY29tbW9uL3V0aWxzL0VudGl0eVV0aWxzLmpzXCJcblxuYXNzZXJ0TWFpbk9yTm9kZSgpXG5cbmNvbnN0IEZJWEVEX0ZSRUVfU0VBUkNIX0RBWVMgPSAyOFxuXG5leHBvcnQgY29uc3QgZW51bSBTZWFyY2hDYXRlZ29yeVR5cGVzIHtcblx0bWFpbCA9IFwibWFpbFwiLFxuXHRjb250YWN0ID0gXCJjb250YWN0XCIsXG5cdGNhbGVuZGFyID0gXCJjYWxlbmRhclwiLFxufVxuXG5jb25zdCBTRUFSQ0hfQ0FURUdPUklFUyA9IFtcblx0e1xuXHRcdG5hbWU6IFNlYXJjaENhdGVnb3J5VHlwZXMubWFpbCxcblx0XHR0eXBlUmVmOiBNYWlsVHlwZVJlZixcblx0fSxcblx0e1xuXHRcdG5hbWU6IFNlYXJjaENhdGVnb3J5VHlwZXMuY29udGFjdCxcblx0XHR0eXBlUmVmOiBDb250YWN0VHlwZVJlZixcblx0fSxcblx0e1xuXHRcdG5hbWU6IFNlYXJjaENhdGVnb3J5VHlwZXMuY2FsZW5kYXIsXG5cdFx0dHlwZVJlZjogQ2FsZW5kYXJFdmVudFR5cGVSZWYsXG5cdH0sXG5dIGFzIGNvbnN0XG5cbi8qKiBnZXQgdGhlIFR5cGVSZWYgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgc2VsZWN0ZWQgY2F0ZWdvcnkgKGFzIHRha2VuIGZyb20gdGhlIFVSTDogPGhvc3Q+L3NlYXJjaC88Y2F0ZWdvcnk+PzxxdWVyeT4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRTZWFyY2hUeXBlKGNhdGVnb3J5OiBzdHJpbmcpOiBUeXBlUmVmPENhbGVuZGFyRXZlbnQ+IHwgVHlwZVJlZjxNYWlsPiB8IFR5cGVSZWY8Q29udGFjdD4ge1xuXHRyZXR1cm4gYXNzZXJ0Tm90TnVsbChTRUFSQ0hfQ0FURUdPUklFUy5maW5kKChjKSA9PiBjLm5hbWUgPT09IGNhdGVnb3J5KSkudHlwZVJlZlxufVxuXG5pbnRlcmZhY2UgU2VhcmNoTWFpbEZpZWxkIHtcblx0cmVhZG9ubHkgdGV4dElkOiBUcmFuc2xhdGlvbktleVxuXHRyZWFkb25seSBmaWVsZDogc3RyaW5nIHwgbnVsbFxuXHRyZWFkb25seSBhdHRyaWJ1dGVJZHM6IG51bWJlcltdIHwgbnVsbFxufVxuXG5leHBvcnQgY29uc3QgU0VBUkNIX01BSUxfRklFTERTOiBSZWFkb25seUFycmF5PFNlYXJjaE1haWxGaWVsZD4gPSBbXG5cdHtcblx0XHR0ZXh0SWQ6IFwiYWxsX2xhYmVsXCIsXG5cdFx0ZmllbGQ6IG51bGwsXG5cdFx0YXR0cmlidXRlSWRzOiBudWxsLFxuXHR9LFxuXHR7XG5cdFx0dGV4dElkOiBcInN1YmplY3RfbGFiZWxcIixcblx0XHRmaWVsZDogXCJzdWJqZWN0XCIsXG5cdFx0YXR0cmlidXRlSWRzOiBbdHlwZU1vZGVscy5NYWlsLnZhbHVlc1tcInN1YmplY3RcIl0uaWQgYXMgbnVtYmVyXSxcblx0fSxcblx0e1xuXHRcdHRleHRJZDogXCJtYWlsQm9keV9sYWJlbFwiLFxuXHRcdGZpZWxkOiBcImJvZHlcIixcblx0XHRhdHRyaWJ1dGVJZHM6IFtMRUdBQ1lfQk9EWV9JRCAvKiogaWQgb2YgdGhlIGxlZ2FjeSB0eXBlTW9kZWxzLk1haWwuYXNzb2NpYXRpb25zW1wiYm9keVwiXSAqL10sXG5cdH0sXG5cdHtcblx0XHR0ZXh0SWQ6IFwiZnJvbV9sYWJlbFwiLFxuXHRcdGZpZWxkOiBcImZyb21cIixcblx0XHRhdHRyaWJ1dGVJZHM6IFt0eXBlTW9kZWxzLk1haWwuYXNzb2NpYXRpb25zW1wic2VuZGVyXCJdLmlkIGFzIG51bWJlcl0sXG5cdH0sXG5cdHtcblx0XHR0ZXh0SWQ6IFwidG9fbGFiZWxcIixcblx0XHRmaWVsZDogXCJ0b1wiLFxuXHRcdGF0dHJpYnV0ZUlkczogW1xuXHRcdFx0TEVHQUNZX1RPX1JFQ0lQSUVOVFNfSUQgLyoqIGlkIG9mIHRoZSBsZWdhY3kgTWFpbC50b1JlY2lwaWVudHMgKi8sXG5cdFx0XHRMRUdBQ1lfQ0NfUkVDSVBJRU5UU19JRCAvKiogaWQgb2YgdGhlIGxlZ2FjeSBNYWlsLmNjUmVjaXBpZW50cyAqLyxcblx0XHRcdExFR0FDWV9CQ0NfUkVDSVBJRU5UU19JRCAvKiogaWQgb2YgdGhlIGxlZ2FjeSBNYWlsLmJjY1JlY2lwaWVudHMgKi8sXG5cdFx0XSxcblx0fSxcblx0e1xuXHRcdHRleHRJZDogXCJhdHRhY2htZW50TmFtZV9sYWJlbFwiLFxuXHRcdGZpZWxkOiBcImF0dGFjaG1lbnRcIixcblx0XHRhdHRyaWJ1dGVJZHM6IFt0eXBlTW9kZWxzLk1haWwuYXNzb2NpYXRpb25zW1wiYXR0YWNobWVudHNcIl0uaWQgYXMgbnVtYmVyXSxcblx0fSxcbl1cblxuY29uc3Qgcm91dGVTZXRUaHJvdHRsZWQ6IFJvdXRlU2V0Rm4gPSB0aHJvdHRsZVJvdXRlKClcblxuZXhwb3J0IGZ1bmN0aW9uIHNldFNlYXJjaFVybCh1cmw6IHN0cmluZykge1xuXHRpZiAodXJsICE9PSBtLnJvdXRlLmdldCgpKSB7XG5cdFx0cm91dGVTZXRUaHJvdHRsZWQodXJsLCB7fSlcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2VhcmNoQ2F0ZWdvcnlGb3JSZXN0cmljdGlvbihyZXN0cmljdGlvbjogU2VhcmNoUmVzdHJpY3Rpb24pOiBTZWFyY2hDYXRlZ29yeVR5cGVzIHtcblx0cmV0dXJuIGFzc2VydE5vdE51bGwoU0VBUkNIX0NBVEVHT1JJRVMuZmluZCgoYykgPT4gaXNTYW1lVHlwZVJlZihjLnR5cGVSZWYsIHJlc3RyaWN0aW9uLnR5cGUpKSkubmFtZVxufVxuXG4vLyBHZXRzIHRoZSByZXN1bHRpbmcgVVJMIGlmIHRoZSBvdXRwdXQgb2YgYGdldFNlYXJjaFBhcmFtZXRlcnMoKWAgd2FzIHJvdXRlZCB0b1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNlYXJjaFVybChxdWVyeTogc3RyaW5nIHwgbnVsbCwgcmVzdHJpY3Rpb246IFNlYXJjaFJlc3RyaWN0aW9uLCBzZWxlY3Rpb25LZXk6IHN0cmluZyB8IG51bGwgPSBudWxsKTogc3RyaW5nIHtcblx0Y29uc3QgeyBwYXRoLCBwYXJhbXMgfSA9IGdldFNlYXJjaFBhcmFtZXRlcnMocXVlcnksIHJlc3RyaWN0aW9uLCBzZWxlY3Rpb25LZXkpXG5cdHJldHVybiBtLmJ1aWxkUGF0aG5hbWUocGF0aCwgcGFyYW1zIGFzIG0uUGFyYW1zKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2VhcmNoUGFyYW1ldGVycyhcblx0cXVlcnk6IHN0cmluZyB8IG51bGwsXG5cdHJlc3RyaWN0aW9uOiBTZWFyY2hSZXN0cmljdGlvbixcblx0c2VsZWN0aW9uS2V5OiBzdHJpbmcgfCBudWxsLFxuKToge1xuXHRwYXRoOiBzdHJpbmdcblx0cGFyYW1zOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCBudW1iZXIgfCBBcnJheTxzdHJpbmc+PlxufSB7XG5cdGNvbnN0IGNhdGVnb3J5ID0gc2VhcmNoQ2F0ZWdvcnlGb3JSZXN0cmljdGlvbihyZXN0cmljdGlvbilcblx0Y29uc3QgcGFyYW1zOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCBudW1iZXIgfCBBcnJheTxzdHJpbmc+PiA9IHtcblx0XHRxdWVyeTogcXVlcnkgPz8gXCJcIixcblx0XHRjYXRlZ29yeSxcblx0fVxuXHQvLyBhIGJpdCBhbm5veWluZyBidXQgYXZvaWRzIHB1dHRpbmcgdW5uZWNlc3NhcnkgdGhpbmdzIGludG8gdGhlIHVybCAoaWYgd2Ugd291bGQgcHV0IHVuZGVmaW5lZCBpbnRvIGl0KVxuXHRpZiAocmVzdHJpY3Rpb24uc3RhcnQpIHtcblx0XHRwYXJhbXMuc3RhcnQgPSByZXN0cmljdGlvbi5zdGFydFxuXHR9XG5cdGlmIChyZXN0cmljdGlvbi5lbmQpIHtcblx0XHRwYXJhbXMuZW5kID0gcmVzdHJpY3Rpb24uZW5kXG5cdH1cblx0aWYgKHJlc3RyaWN0aW9uLmZvbGRlcklkcy5sZW5ndGggPiAwKSB7XG5cdFx0cGFyYW1zLmZvbGRlciA9IHJlc3RyaWN0aW9uLmZvbGRlcklkc1xuXHR9XG5cdGlmIChyZXN0cmljdGlvbi5maWVsZCkge1xuXHRcdHBhcmFtcy5maWVsZCA9IHJlc3RyaWN0aW9uLmZpZWxkXG5cdH1cblx0aWYgKHJlc3RyaWN0aW9uLmV2ZW50U2VyaWVzICE9IG51bGwpIHtcblx0XHRwYXJhbXMuZXZlbnRTZXJpZXMgPSBTdHJpbmcocmVzdHJpY3Rpb24uZXZlbnRTZXJpZXMpXG5cdH1cblxuXHRyZXR1cm4ge1xuXHRcdHBhdGg6IFwiL3NlYXJjaC86Y2F0ZWdvcnlcIiArIChzZWxlY3Rpb25LZXkgPyBcIi9cIiArIHNlbGVjdGlvbktleSA6IFwiXCIpLFxuXHRcdHBhcmFtczogcGFyYW1zLFxuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGcmVlU2VhcmNoU3RhcnREYXRlKCk6IERhdGUge1xuXHRyZXR1cm4gZ2V0U3RhcnRPZkRheShnZXREYXlTaGlmdGVkKG5ldyBEYXRlKCksIC1GSVhFRF9GUkVFX1NFQVJDSF9EQVlTKSlcbn1cblxuLyoqXG4gKiBBZGp1c3RzIHRoZSByZXN0cmljdGlvbiBhY2NvcmRpbmcgdG8gdGhlIGFjY291bnQgdHlwZSBpZiBuZWNlc3NhcnlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJlc3RyaWN0aW9uKFxuXHRzZWFyY2hDYXRlZ29yeTogU2VhcmNoQ2F0ZWdvcnlUeXBlcyxcblx0c3RhcnQ6IG51bWJlciB8IG51bGwsXG5cdGVuZDogbnVtYmVyIHwgbnVsbCxcblx0ZmllbGQ6IHN0cmluZyB8IG51bGwsXG5cdGZvbGRlcklkczogQXJyYXk8c3RyaW5nPixcblx0ZXZlbnRTZXJpZXM6IGJvb2xlYW4gfCBudWxsLFxuKTogU2VhcmNoUmVzdHJpY3Rpb24ge1xuXHRpZiAobG9jYXRvci5sb2dpbnMuZ2V0VXNlckNvbnRyb2xsZXIoKS5pc0ZyZWVBY2NvdW50KCkgJiYgc2VhcmNoQ2F0ZWdvcnkgPT09IFNlYXJjaENhdGVnb3J5VHlwZXMubWFpbCkge1xuXHRcdHN0YXJ0ID0gbnVsbFxuXHRcdGVuZCA9IGdldEZyZWVTZWFyY2hTdGFydERhdGUoKS5nZXRUaW1lKClcblx0XHRmaWVsZCA9IG51bGxcblx0XHRmb2xkZXJJZHMgPSBbXVxuXHRcdGV2ZW50U2VyaWVzID0gbnVsbFxuXHR9XG5cblx0bGV0IHI6IFNlYXJjaFJlc3RyaWN0aW9uID0ge1xuXHRcdHR5cGU6IGdldFNlYXJjaFR5cGUoc2VhcmNoQ2F0ZWdvcnkpLFxuXHRcdHN0YXJ0OiBzdGFydCxcblx0XHRlbmQ6IGVuZCxcblx0XHRmaWVsZDogbnVsbCxcblx0XHRhdHRyaWJ1dGVJZHM6IG51bGwsXG5cdFx0Zm9sZGVySWRzLFxuXHRcdGV2ZW50U2VyaWVzLFxuXHR9XG5cblx0aWYgKCFmaWVsZCkge1xuXHRcdHJldHVybiByXG5cdH1cblxuXHRpZiAoc2VhcmNoQ2F0ZWdvcnkgPT09IFNlYXJjaENhdGVnb3J5VHlwZXMubWFpbCkge1xuXHRcdGxldCBmaWVsZERhdGEgPSBTRUFSQ0hfTUFJTF9GSUVMRFMuZmluZCgoZikgPT4gZi5maWVsZCA9PT0gZmllbGQpXG5cblx0XHRpZiAoZmllbGREYXRhKSB7XG5cdFx0XHRyLmZpZWxkID0gZmllbGRcblx0XHRcdHIuYXR0cmlidXRlSWRzID0gZmllbGREYXRhLmF0dHJpYnV0ZUlkc1xuXHRcdH1cblx0fSBlbHNlIGlmIChzZWFyY2hDYXRlZ29yeSA9PT0gU2VhcmNoQ2F0ZWdvcnlUeXBlcy5jb250YWN0KSB7XG5cdFx0Ly8gbm90aGluZyB0byBkbywgdGhlIGNhbGVuZGFyIHJlc3RyaWN0aW9uIHdhcyBjb21wbGV0ZWx5IHNldCB1cCBhbHJlYWR5LlxuXHR9IGVsc2UgaWYgKHNlYXJjaENhdGVnb3J5ID09PSBTZWFyY2hDYXRlZ29yeVR5cGVzLmNhbGVuZGFyKSB7XG5cdFx0aWYgKGZpZWxkID09PSBcInJlY2lwaWVudFwiKSB7XG5cdFx0XHRyLmZpZWxkID0gZmllbGRcblx0XHRcdHIuYXR0cmlidXRlSWRzID0gW1xuXHRcdFx0XHR0eXBlTW9kZWxzLkNvbnRhY3QudmFsdWVzW1wiZmlyc3ROYW1lXCJdLmlkLFxuXHRcdFx0XHR0eXBlTW9kZWxzLkNvbnRhY3QudmFsdWVzW1wibGFzdE5hbWVcIl0uaWQsXG5cdFx0XHRcdHR5cGVNb2RlbHMuQ29udGFjdC5hc3NvY2lhdGlvbnNbXCJtYWlsQWRkcmVzc2VzXCJdLmlkLFxuXHRcdFx0XVxuXHRcdH0gZWxzZSBpZiAoZmllbGQgPT09IFwibWFpbEFkZHJlc3NcIikge1xuXHRcdFx0ci5maWVsZCA9IGZpZWxkXG5cdFx0XHRyLmF0dHJpYnV0ZUlkcyA9IFt0eXBlTW9kZWxzLkNvbnRhY3QuYXNzb2NpYXRpb25zW1wibWFpbEFkZHJlc3Nlc1wiXS5pZF1cblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gclxufVxuXG4vKipcbiAqIEFkanVzdHMgdGhlIHJlc3RyaWN0aW9uIGFjY29yZGluZyB0byB0aGUgYWNjb3VudCB0eXBlIGlmIG5lY2Vzc2FyeVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVzdHJpY3Rpb24ocm91dGU6IHN0cmluZyk6IFNlYXJjaFJlc3RyaWN0aW9uIHtcblx0bGV0IGNhdGVnb3J5OiBTZWFyY2hDYXRlZ29yeVR5cGVzXG5cdGxldCBzdGFydDogbnVtYmVyIHwgbnVsbCA9IG51bGxcblx0bGV0IGVuZDogbnVtYmVyIHwgbnVsbCA9IG51bGxcblx0bGV0IGZpZWxkOiBzdHJpbmcgfCBudWxsID0gbnVsbFxuXHRsZXQgZm9sZGVySWRzOiBBcnJheTxzdHJpbmc+ID0gW11cblx0bGV0IGV2ZW50U2VyaWVzOiBib29sZWFuIHwgbnVsbCA9IG51bGxcblxuXHRpZiAocm91dGUuc3RhcnRzV2l0aChcIi9tYWlsXCIpIHx8IHJvdXRlLnN0YXJ0c1dpdGgoXCIvc2VhcmNoL21haWxcIikpIHtcblx0XHRjYXRlZ29yeSA9IFNlYXJjaENhdGVnb3J5VHlwZXMubWFpbFxuXG5cdFx0aWYgKHJvdXRlLnN0YXJ0c1dpdGgoXCIvc2VhcmNoL21haWxcIikpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdC8vIG1pdGhyaWwgd2lsbCBwYXJzZSBib29sZWFuIGJ1dCBub3QgbnVtYmVyc1xuXHRcdFx0XHRjb25zdCB7IHBhcmFtcyB9ID0gbS5wYXJzZVBhdGhuYW1lKHJvdXRlKVxuXHRcdFx0XHRpZiAodHlwZW9mIHBhcmFtc1tcInN0YXJ0XCJdID09PSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdFx0c3RhcnQgPSBmaWx0ZXJJbnQocGFyYW1zW1wic3RhcnRcIl0pXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mIHBhcmFtc1tcImVuZFwiXSA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRcdGVuZCA9IGZpbHRlckludChwYXJhbXNbXCJlbmRcIl0pXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mIHBhcmFtc1tcImZpZWxkXCJdID09PSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdFx0Y29uc3QgZmllbGRTdHJpbmcgPSBwYXJhbXNbXCJmaWVsZFwiXVxuXHRcdFx0XHRcdGZpZWxkID0gU0VBUkNIX01BSUxfRklFTERTLmZpbmQoKGYpID0+IGYuZmllbGQgPT09IGZpZWxkU3RyaW5nKT8uZmllbGQgPz8gbnVsbFxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKEFycmF5LmlzQXJyYXkocGFyYW1zW1wiZm9sZGVyXCJdKSkge1xuXHRcdFx0XHRcdGZvbGRlcklkcyA9IHBhcmFtc1tcImZvbGRlclwiXVxuXHRcdFx0XHR9XG5cdFx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKFwiaW52YWxpZCBxdWVyeTogXCIgKyByb3V0ZSwgZSlcblx0XHRcdH1cblx0XHR9XG5cdH0gZWxzZSBpZiAocm91dGUuc3RhcnRzV2l0aChcIi9jb250YWN0XCIpIHx8IHJvdXRlLnN0YXJ0c1dpdGgoXCIvc2VhcmNoL2NvbnRhY3RcIikpIHtcblx0XHRjYXRlZ29yeSA9IFNlYXJjaENhdGVnb3J5VHlwZXMuY29udGFjdFxuXHR9IGVsc2UgaWYgKHJvdXRlLnN0YXJ0c1dpdGgoXCIvY2FsZW5kYXJcIikgfHwgcm91dGUuc3RhcnRzV2l0aChcIi9zZWFyY2gvY2FsZW5kYXJcIikpIHtcblx0XHRjb25zdCB7IHBhcmFtcyB9ID0gbS5wYXJzZVBhdGhuYW1lKHJvdXRlKVxuXG5cdFx0dHJ5IHtcblx0XHRcdGlmICh0eXBlb2YgcGFyYW1zW1wiZXZlbnRTZXJpZXNcIl0gPT09IFwiYm9vbGVhblwiKSB7XG5cdFx0XHRcdGV2ZW50U2VyaWVzID0gcGFyYW1zW1wiZXZlbnRTZXJpZXNcIl1cblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBwYXJhbXNbXCJzdGFydFwiXSA9PT0gXCJzdHJpbmdcIikge1xuXHRcdFx0XHRzdGFydCA9IGZpbHRlckludChwYXJhbXNbXCJzdGFydFwiXSlcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBwYXJhbXNbXCJlbmRcIl0gPT09IFwic3RyaW5nXCIpIHtcblx0XHRcdFx0ZW5kID0gZmlsdGVySW50KHBhcmFtc1tcImVuZFwiXSlcblx0XHRcdH1cblxuXHRcdFx0Y29uc3QgZm9sZGVyID0gcGFyYW1zW1wiZm9sZGVyXCJdXG5cdFx0XHRpZiAoQXJyYXkuaXNBcnJheShmb2xkZXIpKSB7XG5cdFx0XHRcdGZvbGRlcklkcyA9IGZvbGRlclxuXHRcdFx0fVxuXHRcdH0gY2F0Y2ggKGUpIHtcblx0XHRcdGNvbnNvbGUubG9nKFwiaW52YWxpZCBxdWVyeTogXCIgKyByb3V0ZSwgZSlcblx0XHR9XG5cblx0XHRjYXRlZ29yeSA9IFNlYXJjaENhdGVnb3J5VHlwZXMuY2FsZW5kYXJcblx0XHRpZiAoc3RhcnQgPT0gbnVsbCB8fCBsb2NhdG9yLmxvZ2lucy5nZXRVc2VyQ29udHJvbGxlcigpLmlzRnJlZUFjY291bnQoKSkge1xuXHRcdFx0Y29uc3Qgbm93ID0gbmV3IERhdGUoKVxuXHRcdFx0bm93LnNldERhdGUoMSlcblx0XHRcdHN0YXJ0ID0gZ2V0U3RhcnRPZkRheShub3cpLmdldFRpbWUoKVxuXHRcdH1cblxuXHRcdGlmIChlbmQgPT0gbnVsbCB8fCBsb2NhdG9yLmxvZ2lucy5nZXRVc2VyQ29udHJvbGxlcigpLmlzRnJlZUFjY291bnQoKSkge1xuXHRcdFx0Y29uc3QgZW5kRGF0ZSA9IGluY3JlbWVudE1vbnRoKG5ldyBEYXRlKHN0YXJ0KSwgMylcblx0XHRcdGVuZERhdGUuc2V0RGF0ZSgwKVxuXHRcdFx0ZW5kID0gZ2V0RW5kT2ZEYXkoZW5kRGF0ZSkuZ2V0VGltZSgpXG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdHRocm93IG5ldyBFcnJvcihcImludmFsaWQgdHlwZSBcIiArIHJvdXRlKVxuXHR9XG5cblx0cmV0dXJuIGNyZWF0ZVJlc3RyaWN0aW9uKGNhdGVnb3J5LCBzdGFydCwgZW5kLCBmaWVsZCwgZm9sZGVySWRzLCBldmVudFNlcmllcylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlY29kZUNhbGVuZGFyU2VhcmNoS2V5KHNlYXJjaEtleTogc3RyaW5nKTogeyBpZDogSWQ7IHN0YXJ0OiBudW1iZXIgfSB7XG5cdHJldHVybiBKU09OLnBhcnNlKGRlY29kZUJhc2U2NChcInV0Zi04XCIsIGJhc2U2NFVybFRvQmFzZTY0KHNlYXJjaEtleSkpKSBhcyB7IGlkOiBJZDsgc3RhcnQ6IG51bWJlciB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmNvZGVDYWxlbmRhclNlYXJjaEtleShldmVudDogQ2FsZW5kYXJFdmVudCk6IHN0cmluZyB7XG5cdGNvbnN0IGV2ZW50U3RhcnRUaW1lID0gZXZlbnQuc3RhcnRUaW1lLmdldFRpbWUoKVxuXHRyZXR1cm4gYmFzZTY0VG9CYXNlNjRVcmwoc3RyaW5nVG9CYXNlNjQoSlNPTi5zdHJpbmdpZnkoeyBzdGFydDogZXZlbnRTdGFydFRpbWUsIGlkOiBnZXRFbGVtZW50SWQoZXZlbnQpIH0pKSlcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQThCQSxrQkFBa0I7QUFFbEIsTUFBTSx5QkFBeUI7SUFFYixzREFBWDtBQUNOO0FBQ0E7QUFDQTs7QUFDQTtBQUVELE1BQU0sb0JBQW9CO0NBQ3pCO0VBQ0MsTUFBTSxvQkFBb0I7RUFDMUIsU0FBUztDQUNUO0NBQ0Q7RUFDQyxNQUFNLG9CQUFvQjtFQUMxQixTQUFTO0NBQ1Q7Q0FDRDtFQUNDLE1BQU0sb0JBQW9CO0VBQzFCLFNBQVM7Q0FDVDtBQUNEO0FBR00sU0FBUyxjQUFjQSxVQUE2RTtBQUMxRyxRQUFPLGNBQWMsa0JBQWtCLEtBQUssQ0FBQyxNQUFNLEVBQUUsU0FBUyxTQUFTLENBQUMsQ0FBQztBQUN6RTtNQVFZQyxxQkFBcUQ7Q0FDakU7RUFDQyxRQUFRO0VBQ1IsT0FBTztFQUNQLGNB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