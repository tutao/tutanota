import "./dist-chunk.js";
import "./ProgrammingError-chunk.js";
import { assertWorkerOrNode } from "./Env-chunk.js";
import { freshVersioned, getFirstOrThrow, neverNull } from "./dist2-chunk.js";
import { AccountType, Const, CounterType, DEFAULT_KDF_TYPE, GroupType } from "./TutanotaConstants-chunk.js";
import "./EntityUtils-chunk.js";
import "./TypeModels-chunk.js";
import { createUserAccountCreateData, createUserAccountUserData } from "./TypeRefs-chunk.js";
import "./TypeModels2-chunk.js";
import { GroupTypeRef, createMembershipAddData, createResetPasswordPostIn, createUserDataDelete } from "./TypeRefs2-chunk.js";
import "./CryptoError-chunk.js";
import { MembershipService, ResetPasswordService, SystemKeysService, UserService } from "./Services-chunk.js";
import { aes256RandomKey, createAuthVerifier, encryptKey, generateRandomSalt, random, uint8ArrayToKey } from "./dist3-chunk.js";
import { encryptBytes, encryptKeyWithVersionedKey, encryptString } from "./CryptoWrapper-chunk.js";
import { UserAccountService } from "./Services2-chunk.js";

//#region src/common/api/worker/facades/lazy/UserManagementFacade.ts
assertWorkerOrNode();
var UserManagementFacade = class {
	constructor(userFacade, groupManagement, counters, entityClient, serviceExecutor, operationProgressTracker, loginFacade, pqFacade, keyLoaderFacade, recoverCodeFacade) {
		this.userFacade = userFacade;
		this.groupManagement = groupManagement;
		this.counters = counters;
		this.entityClient = entityClient;
		this.serviceExecutor = serviceExecutor;
		this.operationProgressTracker = operationProgressTracker;
		this.loginFacade = loginFacade;
		this.pqFacade = pqFacade;
		this.keyLoaderFacade = keyLoaderFacade;
		this.recoverCodeFacade = recoverCodeFacade;
	}
	async changeUserPassword(user, newPassword) {
		const userGroupKey = await this.groupManagement.getCurrentGroupKeyViaAdminEncGKey(user.userGroup.group);
		const salt = generateRandomSalt();
		const kdfType = DEFAULT_KDF_TYPE;
		const passwordKey = await this.loginFacade.deriveUserPassphraseKey({
			kdfType,
			passphrase: newPassword,
			salt
		});
		const pwEncUserGroupKey = encryptKey(passwordKey, userGroupKey.object);
		const passwordVerifier = createAuthVerifier(passwordKey);
		const data = createResetPasswordPostIn({
			user: user._id,
			salt,
			verifier: passwordVerifier,
			pwEncUserGroupKey,
			kdfVersion: kdfType,
			userGroupKeyVersion: String(userGroupKey.version)
		});
		await this.serviceExecutor.post(ResetPasswordService, data);
	}
	async changeAdminFlag(user, admin) {
		const adminGroupId = this.userFacade.getGroupId(GroupType.Admin);
		const userGroup = await this.entityClient.load(GroupTypeRef, user.userGroup.group);
		const userGroupKey = await this.groupManagement.getCurrentGroupKeyViaAdminEncGKey(userGroup._id);
		if (admin) {
			await this.groupManagement.addUserToGroup(user, adminGroupId);
			if (user.accountType !== AccountType.SYSTEM) {
				const keyData = await this._getAccountKeyData();
				const userEncAccountGroupKey = encryptKeyWithVersionedKey(userGroupKey, keyData.accountGroupKey);
				const addAccountGroup = createMembershipAddData({
					user: user._id,
					group: keyData.accountGroup,
					symEncGKey: userEncAccountGroupKey.key,
					symKeyVersion: userEncAccountGroupKey.encryptingKeyVersion.toString(),
					groupKeyVersion: keyData.accountGroupKeyVersion
				});
				await this.serviceExecutor.post(MembershipService, addAccountGroup);
			}
		} else {
			await this.groupManagement.removeUserFromGroup(user._id, adminGroupId);
			if (user.accountType !== AccountType.SYSTEM) {
				const keyData = await this._getAccountKeyData();
				return this.groupManagement.removeUserFromGroup(user._id, keyData.accountGroup);
			}
		}
	}
	/**
	* Get key and id of premium group.
	* @throws Error if account type is not paid
	*
	* @private
	*/
	async _getAccountKeyData() {
		const keysReturn = await this.serviceExecutor.get(SystemKeysService, null);
		const user = this.userFacade.getLoggedInUser();
		if (user.accountType === AccountType.PAID) return {
			accountGroup: neverNull(keysReturn.premiumGroup),
			accountGroupKey: uint8ArrayToKey(keysReturn.premiumGroupKey),
			accountGroupKeyVersion: keysReturn.premiumGroupKeyVersion
		};
else throw new Error(`Trying to get keyData for user with account type ${user.accountType}`);
	}
	async readUsedUserStorage(user) {
		const counterValue = await this.counters.readCounterValue(CounterType.UserStorageLegacy, neverNull(user.customer), user.userGroup.group);
		return Number(counterValue);
	}
	async deleteUser(user, restore) {
		const data = createUserDataDelete({
			user: user._id,
			restore,
			date: Const.CURRENT_DATE
		});
		await this.serviceExecutor.delete(UserService, data);
	}
	async createUser(name, mailAddress, password, userIndex, overallNbrOfUsersToCreate, operationId) {
		let adminGroupIds = this.userFacade.getGroupIds(GroupType.Admin);
		const adminGroupId = getFirstOrThrow(adminGroupIds);
		const adminGroupKey = await this.keyLoaderFacade.getCurrentSymGroupKey(adminGroupId);
		const customerGroupKey = await this.keyLoaderFacade.getCurrentSymGroupKey(this.userFacade.getGroupId(GroupType.Customer));
		const userGroupKey = freshVersioned(aes256RandomKey());
		const userGroupInfoSessionKey = aes256RandomKey();
		const keyPair = await this.pqFacade.generateKeyPairs();
		const userGroupData = this.groupManagement.generateInternalGroupData(keyPair, userGroupKey.object, userGroupInfoSessionKey, adminGroupId, adminGroupKey, customerGroupKey);
		await this.operationProgressTracker.onProgress(operationId, (userIndex + .8) / overallNbrOfUsersToCreate * 100);
		let data = createUserAccountCreateData({
			date: Const.CURRENT_DATE,
			userGroupData,
			userData: await this.generateUserAccountData(userGroupKey, userGroupInfoSessionKey, customerGroupKey, mailAddress, password, name, this.recoverCodeFacade.generateRecoveryCode(userGroupKey))
		});
		await this.serviceExecutor.post(UserAccountService, data);
		return this.operationProgressTracker.onProgress(operationId, (userIndex + 1) / overallNbrOfUsersToCreate * 100);
	}
	async generateUserAccountData(userGroupKey, userGroupInfoSessionKey, customerGroupKey, mailAddress, passphrase, userName, recoverData) {
		const kdfType = DEFAULT_KDF_TYPE;
		const salt = generateRandomSalt();
		const userPassphraseKey = await this.loginFacade.deriveUserPassphraseKey({
			kdfType,
			passphrase,
			salt
		});
		const mailGroupKey = freshVersioned(aes256RandomKey());
		const contactGroupKey = freshVersioned(aes256RandomKey());
		const fileGroupKey = freshVersioned(aes256RandomKey());
		const mailboxSessionKey = aes256RandomKey();
		const contactListSessionKey = aes256RandomKey();
		const fileSystemSessionKey = aes256RandomKey();
		const mailGroupInfoSessionKey = aes256RandomKey();
		const contactGroupInfoSessionKey = aes256RandomKey();
		const fileGroupInfoSessionKey = aes256RandomKey();
		const tutanotaPropertiesSessionKey = aes256RandomKey();
		const userEncCustomerGroupKey = encryptKeyWithVersionedKey(userGroupKey, customerGroupKey.object);
		const userEncMailGroupKey = encryptKeyWithVersionedKey(userGroupKey, mailGroupKey.object);
		const userEncContactGroupKey = encryptKeyWithVersionedKey(userGroupKey, contactGroupKey.object);
		const userEncFileGroupKey = encryptKeyWithVersionedKey(userGroupKey, fileGroupKey.object);
		const userEncTutanotaPropertiesSessionKey = encryptKeyWithVersionedKey(userGroupKey, tutanotaPropertiesSessionKey);
		const userEncEntropy = encryptBytes(userGroupKey.object, random.generateRandomData(32));
		const customerEncMailGroupInfoSessionKey = encryptKeyWithVersionedKey(customerGroupKey, mailGroupInfoSessionKey);
		const customerEncContactGroupInfoSessionKey = encryptKeyWithVersionedKey(customerGroupKey, contactGroupInfoSessionKey);
		const customerEncFileGroupInfoSessionKey = encryptKeyWithVersionedKey(customerGroupKey, fileGroupInfoSessionKey);
		const contactEncContactListSessionKey = encryptKeyWithVersionedKey(contactGroupKey, contactListSessionKey);
		const fileEncFileSystemSessionKey = encryptKeyWithVersionedKey(fileGroupKey, fileSystemSessionKey);
		const mailEncMailBoxSessionKey = encryptKeyWithVersionedKey(mailGroupKey, mailboxSessionKey);
		return createUserAccountUserData({
			mailAddress,
			encryptedName: encryptString(userGroupInfoSessionKey, userName),
			salt,
			kdfVersion: kdfType,
			verifier: createAuthVerifier(userPassphraseKey),
			pwEncUserGroupKey: encryptKey(userPassphraseKey, userGroupKey.object),
			userEncCustomerGroupKey: userEncCustomerGroupKey.key,
			userEncMailGroupKey: userEncMailGroupKey.key,
			userEncContactGroupKey: userEncContactGroupKey.key,
			userEncFileGroupKey: userEncFileGroupKey.key,
			userEncEntropy,
			userEncTutanotaPropertiesSessionKey: userEncTutanotaPropertiesSessionKey.key,
			contactEncContactListSessionKey: contactEncContactListSessionKey.key,
			fileEncFileSystemSessionKey: fileEncFileSystemSessionKey.key,
			mailEncMailBoxSessionKey: mailEncMailBoxSessionKey.key,
			customerEncMailGroupInfoSessionKey: customerEncMailGroupInfoSessionKey.key,
			customerEncContactGroupInfoSessionKey: customerEncContactGroupInfoSessionKey.key,
			customerEncFileGroupInfoSessionKey: customerEncFileGroupInfoSessionKey.key,
			customerKeyVersion: customerEncContactGroupInfoSessionKey.encryptingKeyVersion.toString(),
			recoverCodeEncUserGroupKey: recoverData.recoverCodeEncUserGroupKey,
			recoverCodeVerifier: recoverData.recoveryCodeVerifier,
			userEncRecoverCode: recoverData.userEncRecoverCode
		});
	}
};

//#endregion
export { UserManagementFacade };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlck1hbmFnZW1lbnRGYWNhZGUtY2h1bmsuanMiLCJuYW1lcyI6WyJ1c2VyRmFjYWRlOiBVc2VyRmFjYWRlIiwiZ3JvdXBNYW5hZ2VtZW50OiBHcm91cE1hbmFnZW1lbnRGYWNhZGUiLCJjb3VudGVyczogQ291bnRlckZhY2FkZSIsImVudGl0eUNsaWVudDogRW50aXR5Q2xpZW50Iiwic2VydmljZUV4ZWN1dG9yOiBJU2VydmljZUV4ZWN1dG9yIiwib3BlcmF0aW9uUHJvZ3Jlc3NUcmFja2VyOiBFeHBvc2VkT3BlcmF0aW9uUHJvZ3Jlc3NUcmFja2VyIiwibG9naW5GYWNhZGU6IExvZ2luRmFjYWRlIiwicHFGYWNhZGU6IFBRRmFjYWRlIiwia2V5TG9hZGVyRmFjYWRlOiBLZXlMb2FkZXJGYWNhZGUiLCJyZWNvdmVyQ29kZUZhY2FkZTogUmVjb3ZlckNvZGVGYWNhZGUiLCJ1c2VyOiBVc2VyIiwibmV3UGFzc3dvcmQ6IHN0cmluZyIsImFkbWluOiBib29sZWFuIiwicmVzdG9yZTogYm9vbGVhbiIsIm5hbWU6IHN0cmluZyIsIm1haWxBZGRyZXNzOiBzdHJpbmciLCJwYXNzd29yZDogc3RyaW5nIiwidXNlckluZGV4OiBudW1iZXIiLCJvdmVyYWxsTmJyT2ZVc2Vyc1RvQ3JlYXRlOiBudW1iZXIiLCJvcGVyYXRpb25JZDogT3BlcmF0aW9uSWQiLCJ1c2VyR3JvdXBLZXk6IFZlcnNpb25lZEtleSIsInVzZXJHcm91cEluZm9TZXNzaW9uS2V5OiBBZXNLZXkiLCJjdXN0b21lckdyb3VwS2V5OiBWZXJzaW9uZWRLZXkiLCJwYXNzcGhyYXNlOiBzdHJpbmciLCJ1c2VyTmFtZTogc3RyaW5nIiwicmVjb3ZlckRhdGE6IFJlY292ZXJEYXRhIl0sInNvdXJjZXMiOlsiLi4vc3JjL2NvbW1vbi9hcGkvd29ya2VyL2ZhY2FkZXMvbGF6eS9Vc2VyTWFuYWdlbWVudEZhY2FkZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBY2NvdW50VHlwZSwgQ29uc3QsIENvdW50ZXJUeXBlLCBERUZBVUxUX0tERl9UWVBFLCBHcm91cFR5cGUgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL1R1dGFub3RhQ29uc3RhbnRzLmpzXCJcbmltcG9ydCB7IGNyZWF0ZU1lbWJlcnNoaXBBZGREYXRhLCBjcmVhdGVSZXNldFBhc3N3b3JkUG9zdEluLCBjcmVhdGVVc2VyRGF0YURlbGV0ZSwgR3JvdXBUeXBlUmVmLCBVc2VyIH0gZnJvbSBcIi4uLy4uLy4uL2VudGl0aWVzL3N5cy9UeXBlUmVmcy5qc1wiXG5pbXBvcnQgeyBnZXRGaXJzdE9yVGhyb3csIG5ldmVyTnVsbCB9IGZyb20gXCJAdHV0YW8vdHV0YW5vdGEtdXRpbHNcIlxuaW1wb3J0IHR5cGUgeyBVc2VyQWNjb3VudFVzZXJEYXRhIH0gZnJvbSBcIi4uLy4uLy4uL2VudGl0aWVzL3R1dGFub3RhL1R5cGVSZWZzLmpzXCJcbmltcG9ydCB7IGNyZWF0ZVVzZXJBY2NvdW50Q3JlYXRlRGF0YSwgY3JlYXRlVXNlckFjY291bnRVc2VyRGF0YSB9IGZyb20gXCIuLi8uLi8uLi9lbnRpdGllcy90dXRhbm90YS9UeXBlUmVmcy5qc1wiXG5pbXBvcnQgdHlwZSB7IEdyb3VwTWFuYWdlbWVudEZhY2FkZSB9IGZyb20gXCIuL0dyb3VwTWFuYWdlbWVudEZhY2FkZS5qc1wiXG5pbXBvcnQgeyBMb2dpbkZhY2FkZSB9IGZyb20gXCIuLi9Mb2dpbkZhY2FkZS5qc1wiXG5pbXBvcnQgeyBDb3VudGVyRmFjYWRlIH0gZnJvbSBcIi4vQ291bnRlckZhY2FkZS5qc1wiXG5pbXBvcnQgeyBhc3NlcnRXb3JrZXJPck5vZGUgfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL0Vudi5qc1wiXG5pbXBvcnQgeyBhZXMyNTZSYW5kb21LZXksIEFlc0tleSwgY3JlYXRlQXV0aFZlcmlmaWVyLCBlbmNyeXB0S2V5LCBnZW5lcmF0ZVJhbmRvbVNhbHQsIHJhbmRvbSwgdWludDhBcnJheVRvS2V5IH0gZnJvbSBcIkB0dXRhby90dXRhbm90YS1jcnlwdG9cIlxuaW1wb3J0IHsgRW50aXR5Q2xpZW50IH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9FbnRpdHlDbGllbnQuanNcIlxuaW1wb3J0IHsgSVNlcnZpY2VFeGVjdXRvciB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vU2VydmljZVJlcXVlc3QuanNcIlxuaW1wb3J0IHsgTWVtYmVyc2hpcFNlcnZpY2UsIFJlc2V0UGFzc3dvcmRTZXJ2aWNlLCBTeXN0ZW1LZXlzU2VydmljZSwgVXNlclNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vLi4vZW50aXRpZXMvc3lzL1NlcnZpY2VzLmpzXCJcbmltcG9ydCB7IFVzZXJBY2NvdW50U2VydmljZSB9IGZyb20gXCIuLi8uLi8uLi9lbnRpdGllcy90dXRhbm90YS9TZXJ2aWNlcy5qc1wiXG5pbXBvcnQgeyBVc2VyRmFjYWRlIH0gZnJvbSBcIi4uL1VzZXJGYWNhZGUuanNcIlxuaW1wb3J0IHsgRXhwb3NlZE9wZXJhdGlvblByb2dyZXNzVHJhY2tlciwgT3BlcmF0aW9uSWQgfSBmcm9tIFwiLi4vLi4vLi4vbWFpbi9PcGVyYXRpb25Qcm9ncmVzc1RyYWNrZXIuanNcIlxuaW1wb3J0IHsgUFFGYWNhZGUgfSBmcm9tIFwiLi4vUFFGYWNhZGUuanNcIlxuaW1wb3J0IHsgZnJlc2hWZXJzaW9uZWQgfSBmcm9tIFwiQHR1dGFvL3R1dGFub3RhLXV0aWxzL2Rpc3QvVXRpbHMuanNcIlxuaW1wb3J0IHsgS2V5TG9hZGVyRmFjYWRlIH0gZnJvbSBcIi4uL0tleUxvYWRlckZhY2FkZS5qc1wiXG5pbXBvcnQgeyBSZWNvdmVyQ29kZUZhY2FkZSwgUmVjb3ZlckRhdGEgfSBmcm9tIFwiLi9SZWNvdmVyQ29kZUZhY2FkZS5qc1wiXG5pbXBvcnQgeyBlbmNyeXB0Qnl0ZXMsIGVuY3J5cHRLZXlXaXRoVmVyc2lvbmVkS2V5LCBlbmNyeXB0U3RyaW5nLCBWZXJzaW9uZWRLZXkgfSBmcm9tIFwiLi4vLi4vY3J5cHRvL0NyeXB0b1dyYXBwZXIuanNcIlxuXG5hc3NlcnRXb3JrZXJPck5vZGUoKVxuXG5leHBvcnQgY2xhc3MgVXNlck1hbmFnZW1lbnRGYWNhZGUge1xuXHRjb25zdHJ1Y3Rvcihcblx0XHRwcml2YXRlIHJlYWRvbmx5IHVzZXJGYWNhZGU6IFVzZXJGYWNhZGUsXG5cdFx0cHJpdmF0ZSByZWFkb25seSBncm91cE1hbmFnZW1lbnQ6IEdyb3VwTWFuYWdlbWVudEZhY2FkZSxcblx0XHRwcml2YXRlIHJlYWRvbmx5IGNvdW50ZXJzOiBDb3VudGVyRmFjYWRlLFxuXHRcdHByaXZhdGUgcmVhZG9ubHkgZW50aXR5Q2xpZW50OiBFbnRpdHlDbGllbnQsXG5cdFx0cHJpdmF0ZSByZWFkb25seSBzZXJ2aWNlRXhlY3V0b3I6IElTZXJ2aWNlRXhlY3V0b3IsXG5cdFx0cHJpdmF0ZSByZWFkb25seSBvcGVyYXRpb25Qcm9ncmVzc1RyYWNrZXI6IEV4cG9zZWRPcGVyYXRpb25Qcm9ncmVzc1RyYWNrZXIsXG5cdFx0cHJpdmF0ZSByZWFkb25seSBsb2dpbkZhY2FkZTogTG9naW5GYWNhZGUsXG5cdFx0cHJpdmF0ZSByZWFkb25seSBwcUZhY2FkZTogUFFGYWNhZGUsXG5cdFx0cHJpdmF0ZSByZWFkb25seSBrZXlMb2FkZXJGYWNhZGU6IEtleUxvYWRlckZhY2FkZSxcblx0XHRwcml2YXRlIHJlYWRvbmx5IHJlY292ZXJDb2RlRmFjYWRlOiBSZWNvdmVyQ29kZUZhY2FkZSxcblx0KSB7fVxuXG5cdGFzeW5jIGNoYW5nZVVzZXJQYXNzd29yZCh1c2VyOiBVc2VyLCBuZXdQYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgdXNlckdyb3VwS2V5ID0gYXdhaXQgdGhpcy5ncm91cE1hbmFnZW1lbnQuZ2V0Q3VycmVudEdyb3VwS2V5VmlhQWRtaW5FbmNHS2V5KHVzZXIudXNlckdyb3VwLmdyb3VwKVxuXHRcdGNvbnN0IHNhbHQgPSBnZW5lcmF0ZVJhbmRvbVNhbHQoKVxuXHRcdGNvbnN0IGtkZlR5cGUgPSBERUZBVUxUX0tERl9UWVBFXG5cdFx0Y29uc3QgcGFzc3dvcmRLZXkgPSBhd2FpdCB0aGlzLmxvZ2luRmFjYWRlLmRlcml2ZVVzZXJQYXNzcGhyYXNlS2V5KHsga2RmVHlwZSwgcGFzc3BocmFzZTogbmV3UGFzc3dvcmQsIHNhbHQgfSlcblx0XHRjb25zdCBwd0VuY1VzZXJHcm91cEtleSA9IGVuY3J5cHRLZXkocGFzc3dvcmRLZXksIHVzZXJHcm91cEtleS5vYmplY3QpXG5cdFx0Y29uc3QgcGFzc3dvcmRWZXJpZmllciA9IGNyZWF0ZUF1dGhWZXJpZmllcihwYXNzd29yZEtleSlcblx0XHRjb25zdCBkYXRhID0gY3JlYXRlUmVzZXRQYXNzd29yZFBvc3RJbih7XG5cdFx0XHR1c2VyOiB1c2VyLl9pZCxcblx0XHRcdHNhbHQsXG5cdFx0XHR2ZXJpZmllcjogcGFzc3dvcmRWZXJpZmllcixcblx0XHRcdHB3RW5jVXNlckdyb3VwS2V5LFxuXHRcdFx0a2RmVmVyc2lvbjoga2RmVHlwZSxcblx0XHRcdHVzZXJHcm91cEtleVZlcnNpb246IFN0cmluZyh1c2VyR3JvdXBLZXkudmVyc2lvbiksXG5cdFx0fSlcblx0XHRhd2FpdCB0aGlzLnNlcnZpY2VFeGVjdXRvci5wb3N0KFJlc2V0UGFzc3dvcmRTZXJ2aWNlLCBkYXRhKVxuXHR9XG5cblx0YXN5bmMgY2hhbmdlQWRtaW5GbGFnKHVzZXI6IFVzZXIsIGFkbWluOiBib29sZWFuKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgYWRtaW5Hcm91cElkID0gdGhpcy51c2VyRmFjYWRlLmdldEdyb3VwSWQoR3JvdXBUeXBlLkFkbWluKVxuXHRcdGNvbnN0IHVzZXJHcm91cCA9IGF3YWl0IHRoaXMuZW50aXR5Q2xpZW50LmxvYWQoR3JvdXBUeXBlUmVmLCB1c2VyLnVzZXJHcm91cC5ncm91cClcblx0XHRjb25zdCB1c2VyR3JvdXBLZXkgPSBhd2FpdCB0aGlzLmdyb3VwTWFuYWdlbWVudC5nZXRDdXJyZW50R3JvdXBLZXlWaWFBZG1pbkVuY0dLZXkodXNlckdyb3VwLl9pZClcblxuXHRcdGlmIChhZG1pbikge1xuXHRcdFx0YXdhaXQgdGhpcy5ncm91cE1hbmFnZW1lbnQuYWRkVXNlclRvR3JvdXAodXNlciwgYWRtaW5Hcm91cElkKVxuXG5cdFx0XHRpZiAodXNlci5hY2NvdW50VHlwZSAhPT0gQWNjb3VudFR5cGUuU1lTVEVNKSB7XG5cdFx0XHRcdGNvbnN0IGtleURhdGEgPSBhd2FpdCB0aGlzLl9nZXRBY2NvdW50S2V5RGF0YSgpXG5cdFx0XHRcdGNvbnN0IHVzZXJFbmNBY2NvdW50R3JvdXBLZXkgPSBlbmNyeXB0S2V5V2l0aFZlcnNpb25lZEtleSh1c2VyR3JvdXBLZXksIGtleURhdGEuYWNjb3VudEdyb3VwS2V5KVxuXG5cdFx0XHRcdC8vIHdlIGNhbiBub3QgdXNlIGFkZFVzZXJUb0dyb3VwIGhlcmUgYmVjYXVzZSB0aGUgYWRtaW4gaXMgbm90IGFkbWluIG9mIHRoZSBhY2NvdW50IGdyb3VwXG5cdFx0XHRcdGNvbnN0IGFkZEFjY291bnRHcm91cCA9IGNyZWF0ZU1lbWJlcnNoaXBBZGREYXRhKHtcblx0XHRcdFx0XHR1c2VyOiB1c2VyLl9pZCxcblx0XHRcdFx0XHRncm91cDoga2V5RGF0YS5hY2NvdW50R3JvdXAsXG5cdFx0XHRcdFx0c3ltRW5jR0tleTogdXNlckVuY0FjY291bnRHcm91cEtleS5rZXksXG5cdFx0XHRcdFx0c3ltS2V5VmVyc2lvbjogdXNlckVuY0FjY291bnRHcm91cEtleS5lbmNyeXB0aW5nS2V5VmVyc2lvbi50b1N0cmluZygpLFxuXHRcdFx0XHRcdGdyb3VwS2V5VmVyc2lvbjoga2V5RGF0YS5hY2NvdW50R3JvdXBLZXlWZXJzaW9uLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHRhd2FpdCB0aGlzLnNlcnZpY2VFeGVjdXRvci5wb3N0KE1lbWJlcnNoaXBTZXJ2aWNlLCBhZGRBY2NvdW50R3JvdXApXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGF3YWl0IHRoaXMuZ3JvdXBNYW5hZ2VtZW50LnJlbW92ZVVzZXJGcm9tR3JvdXAodXNlci5faWQsIGFkbWluR3JvdXBJZClcblxuXHRcdFx0aWYgKHVzZXIuYWNjb3VudFR5cGUgIT09IEFjY291bnRUeXBlLlNZU1RFTSkge1xuXHRcdFx0XHRjb25zdCBrZXlEYXRhID0gYXdhaXQgdGhpcy5fZ2V0QWNjb3VudEtleURhdGEoKVxuXHRcdFx0XHRyZXR1cm4gdGhpcy5ncm91cE1hbmFnZW1lbnQucmVtb3ZlVXNlckZyb21Hcm91cCh1c2VyLl9pZCwga2V5RGF0YS5hY2NvdW50R3JvdXApXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEdldCBrZXkgYW5kIGlkIG9mIHByZW1pdW0gZ3JvdXAuXG5cdCAqIEB0aHJvd3MgRXJyb3IgaWYgYWNjb3VudCB0eXBlIGlzIG5vdCBwYWlkXG5cdCAqXG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRhc3luYyBfZ2V0QWNjb3VudEtleURhdGEoKTogUHJvbWlzZTx7IGFjY291bnRHcm91cDogSWQ7IGFjY291bnRHcm91cEtleVZlcnNpb246IHN0cmluZzsgYWNjb3VudEdyb3VwS2V5OiBBZXNLZXkgfT4ge1xuXHRcdGNvbnN0IGtleXNSZXR1cm4gPSBhd2FpdCB0aGlzLnNlcnZpY2VFeGVjdXRvci5nZXQoU3lzdGVtS2V5c1NlcnZpY2UsIG51bGwpXG5cdFx0Y29uc3QgdXNlciA9IHRoaXMudXNlckZhY2FkZS5nZXRMb2dnZWRJblVzZXIoKVxuXG5cdFx0aWYgKHVzZXIuYWNjb3VudFR5cGUgPT09IEFjY291bnRUeXBlLlBBSUQpIHtcblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdGFjY291bnRHcm91cDogbmV2ZXJOdWxsKGtleXNSZXR1cm4ucHJlbWl1bUdyb3VwKSxcblx0XHRcdFx0YWNjb3VudEdyb3VwS2V5OiB1aW50OEFycmF5VG9LZXkoa2V5c1JldHVybi5wcmVtaXVtR3JvdXBLZXkpLFxuXHRcdFx0XHRhY2NvdW50R3JvdXBLZXlWZXJzaW9uOiBrZXlzUmV0dXJuLnByZW1pdW1Hcm91cEtleVZlcnNpb24sXG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihgVHJ5aW5nIHRvIGdldCBrZXlEYXRhIGZvciB1c2VyIHdpdGggYWNjb3VudCB0eXBlICR7dXNlci5hY2NvdW50VHlwZX1gKVxuXHRcdH1cblx0fVxuXG5cdGFzeW5jIHJlYWRVc2VkVXNlclN0b3JhZ2UodXNlcjogVXNlcik6IFByb21pc2U8bnVtYmVyPiB7XG5cdFx0Y29uc3QgY291bnRlclZhbHVlID0gYXdhaXQgdGhpcy5jb3VudGVycy5yZWFkQ291bnRlclZhbHVlKENvdW50ZXJUeXBlLlVzZXJTdG9yYWdlTGVnYWN5LCBuZXZlck51bGwodXNlci5jdXN0b21lciksIHVzZXIudXNlckdyb3VwLmdyb3VwKVxuXHRcdHJldHVybiBOdW1iZXIoY291bnRlclZhbHVlKVxuXHR9XG5cblx0YXN5bmMgZGVsZXRlVXNlcih1c2VyOiBVc2VyLCByZXN0b3JlOiBib29sZWFuKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgZGF0YSA9IGNyZWF0ZVVzZXJEYXRhRGVsZXRlKHtcblx0XHRcdHVzZXI6IHVzZXIuX2lkLFxuXHRcdFx0cmVzdG9yZSxcblx0XHRcdGRhdGU6IENvbnN0LkNVUlJFTlRfREFURSxcblx0XHR9KVxuXHRcdGF3YWl0IHRoaXMuc2VydmljZUV4ZWN1dG9yLmRlbGV0ZShVc2VyU2VydmljZSwgZGF0YSlcblx0fVxuXG5cdGFzeW5jIGNyZWF0ZVVzZXIoXG5cdFx0bmFtZTogc3RyaW5nLFxuXHRcdG1haWxBZGRyZXNzOiBzdHJpbmcsXG5cdFx0cGFzc3dvcmQ6IHN0cmluZyxcblx0XHR1c2VySW5kZXg6IG51bWJlcixcblx0XHRvdmVyYWxsTmJyT2ZVc2Vyc1RvQ3JlYXRlOiBudW1iZXIsXG5cdFx0b3BlcmF0aW9uSWQ6IE9wZXJhdGlvbklkLFxuXHQpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRsZXQgYWRtaW5Hcm91cElkcyA9IHRoaXMudXNlckZhY2FkZS5nZXRHcm91cElkcyhHcm91cFR5cGUuQWRtaW4pXG5cdFx0Y29uc3QgYWRtaW5Hcm91cElkID0gZ2V0Rmlyc3RPclRocm93KGFkbWluR3JvdXBJZHMpXG5cblx0XHRjb25zdCBhZG1pbkdyb3VwS2V5ID0gYXdhaXQgdGhpcy5rZXlMb2FkZXJGYWNhZGUuZ2V0Q3VycmVudFN5bUdyb3VwS2V5KGFkbWluR3JvdXBJZClcblxuXHRcdGNvbnN0IGN1c3RvbWVyR3JvdXBLZXkgPSBhd2FpdCB0aGlzLmtleUxvYWRlckZhY2FkZS5nZXRDdXJyZW50U3ltR3JvdXBLZXkodGhpcy51c2VyRmFjYWRlLmdldEdyb3VwSWQoR3JvdXBUeXBlLkN1c3RvbWVyKSlcblxuXHRcdGNvbnN0IHVzZXJHcm91cEtleSA9IGZyZXNoVmVyc2lvbmVkKGFlczI1NlJhbmRvbUtleSgpKVxuXHRcdGNvbnN0IHVzZXJHcm91cEluZm9TZXNzaW9uS2V5ID0gYWVzMjU2UmFuZG9tS2V5KClcblx0XHRjb25zdCBrZXlQYWlyID0gYXdhaXQgdGhpcy5wcUZhY2FkZS5nZW5lcmF0ZUtleVBhaXJzKClcblx0XHRjb25zdCB1c2VyR3JvdXBEYXRhID0gdGhpcy5ncm91cE1hbmFnZW1lbnQuZ2VuZXJhdGVJbnRlcm5hbEdyb3VwRGF0YShcblx0XHRcdGtleVBhaXIsXG5cdFx0XHR1c2VyR3JvdXBLZXkub2JqZWN0LFxuXHRcdFx0dXNlckdyb3VwSW5mb1Nlc3Npb25LZXksXG5cdFx0XHRhZG1pbkdyb3VwSWQsXG5cdFx0XHRhZG1pbkdyb3VwS2V5LFxuXHRcdFx0Y3VzdG9tZXJHcm91cEtleSxcblx0XHQpXG5cdFx0YXdhaXQgdGhpcy5vcGVyYXRpb25Qcm9ncmVzc1RyYWNrZXIub25Qcm9ncmVzcyhvcGVyYXRpb25JZCwgKCh1c2VySW5kZXggKyAwLjgpIC8gb3ZlcmFsbE5ick9mVXNlcnNUb0NyZWF0ZSkgKiAxMDApXG5cblx0XHRsZXQgZGF0YSA9IGNyZWF0ZVVzZXJBY2NvdW50Q3JlYXRlRGF0YSh7XG5cdFx0XHRkYXRlOiBDb25zdC5DVVJSRU5UX0RBVEUsXG5cdFx0XHR1c2VyR3JvdXBEYXRhOiB1c2VyR3JvdXBEYXRhLFxuXHRcdFx0dXNlckRhdGE6IGF3YWl0IHRoaXMuZ2VuZXJhdGVVc2VyQWNjb3VudERhdGEoXG5cdFx0XHRcdHVzZXJHcm91cEtleSxcblx0XHRcdFx0dXNlckdyb3VwSW5mb1Nlc3Npb25LZXksXG5cdFx0XHRcdGN1c3RvbWVyR3JvdXBLZXksXG5cdFx0XHRcdG1haWxBZGRyZXNzLFxuXHRcdFx0XHRwYXNzd29yZCxcblx0XHRcdFx0bmFtZSxcblx0XHRcdFx0dGhpcy5yZWNvdmVyQ29kZUZhY2FkZS5nZW5lcmF0ZVJlY292ZXJ5Q29kZSh1c2VyR3JvdXBLZXkpLFxuXHRcdFx0KSxcblx0XHR9KVxuXHRcdGF3YWl0IHRoaXMuc2VydmljZUV4ZWN1dG9yLnBvc3QoVXNlckFjY291bnRTZXJ2aWNlLCBkYXRhKVxuXHRcdHJldHVybiB0aGlzLm9wZXJhdGlvblByb2dyZXNzVHJhY2tlci5vblByb2dyZXNzKG9wZXJhdGlvbklkLCAoKHVzZXJJbmRleCArIDEpIC8gb3ZlcmFsbE5ick9mVXNlcnNUb0NyZWF0ZSkgKiAxMDApXG5cdH1cblxuXHRhc3luYyBnZW5lcmF0ZVVzZXJBY2NvdW50RGF0YShcblx0XHR1c2VyR3JvdXBLZXk6IFZlcnNpb25lZEtleSxcblx0XHR1c2VyR3JvdXBJbmZvU2Vzc2lvbktleTogQWVzS2V5LFxuXHRcdGN1c3RvbWVyR3JvdXBLZXk6IFZlcnNpb25lZEtleSxcblx0XHRtYWlsQWRkcmVzczogc3RyaW5nLFxuXHRcdHBhc3NwaHJhc2U6IHN0cmluZyxcblx0XHR1c2VyTmFtZTogc3RyaW5nLFxuXHRcdHJlY292ZXJEYXRhOiBSZWNvdmVyRGF0YSxcblx0KTogUHJvbWlzZTxVc2VyQWNjb3VudFVzZXJEYXRhPiB7XG5cdFx0Y29uc3Qga2RmVHlwZSA9IERFRkFVTFRfS0RGX1RZUEVcblx0XHRjb25zdCBzYWx0ID0gZ2VuZXJhdGVSYW5kb21TYWx0KClcblx0XHRjb25zdCB1c2VyUGFzc3BocmFzZUtleSA9IGF3YWl0IHRoaXMubG9naW5GYWNhZGUuZGVyaXZlVXNlclBhc3NwaHJhc2VLZXkoeyBrZGZUeXBlLCBwYXNzcGhyYXNlLCBzYWx0IH0pXG5cdFx0Y29uc3QgbWFpbEdyb3VwS2V5ID0gZnJlc2hWZXJzaW9uZWQoYWVzMjU2UmFuZG9tS2V5KCkpXG5cdFx0Y29uc3QgY29udGFjdEdyb3VwS2V5ID0gZnJlc2hWZXJzaW9uZWQoYWVzMjU2UmFuZG9tS2V5KCkpXG5cdFx0Y29uc3QgZmlsZUdyb3VwS2V5ID0gZnJlc2hWZXJzaW9uZWQoYWVzMjU2UmFuZG9tS2V5KCkpXG5cdFx0Y29uc3QgbWFpbGJveFNlc3Npb25LZXkgPSBhZXMyNTZSYW5kb21LZXkoKVxuXHRcdGNvbnN0IGNvbnRhY3RMaXN0U2Vzc2lvbktleSA9IGFlczI1NlJhbmRvbUtleSgpXG5cdFx0Y29uc3QgZmlsZVN5c3RlbVNlc3Npb25LZXkgPSBhZXMyNTZSYW5kb21LZXkoKVxuXHRcdGNvbnN0IG1haWxHcm91cEluZm9TZXNzaW9uS2V5ID0gYWVzMjU2UmFuZG9tS2V5KClcblx0XHRjb25zdCBjb250YWN0R3JvdXBJbmZvU2Vzc2lvbktleSA9IGFlczI1NlJhbmRvbUtleSgpXG5cdFx0Y29uc3QgZmlsZUdyb3VwSW5mb1Nlc3Npb25LZXkgPSBhZXMyNTZSYW5kb21LZXkoKVxuXHRcdGNvbnN0IHR1dGFub3RhUHJvcGVydGllc1Nlc3Npb25LZXkgPSBhZXMyNTZSYW5kb21LZXkoKVxuXG5cdFx0Y29uc3QgdXNlckVuY0N1c3RvbWVyR3JvdXBLZXkgPSBlbmNyeXB0S2V5V2l0aFZlcnNpb25lZEtleSh1c2VyR3JvdXBLZXksIGN1c3RvbWVyR3JvdXBLZXkub2JqZWN0KVxuXHRcdGNvbnN0IHVzZXJFbmNNYWlsR3JvdXBLZXkgPSBlbmNyeXB0S2V5V2l0aFZlcnNpb25lZEtleSh1c2VyR3JvdXBLZXksIG1haWxHcm91cEtleS5vYmplY3QpXG5cdFx0Y29uc3QgdXNlckVuY0NvbnRhY3RHcm91cEtleSA9IGVuY3J5cHRLZXlXaXRoVmVyc2lvbmVkS2V5KHVzZXJHcm91cEtleSwgY29udGFjdEdyb3VwS2V5Lm9iamVjdClcblx0XHRjb25zdCB1c2VyRW5jRmlsZUdyb3VwS2V5ID0gZW5jcnlwdEtleVdpdGhWZXJzaW9uZWRLZXkodXNlckdyb3VwS2V5LCBmaWxlR3JvdXBLZXkub2JqZWN0KVxuXHRcdGNvbnN0IHVzZXJFbmNUdXRhbm90YVByb3BlcnRpZXNTZXNzaW9uS2V5ID0gZW5jcnlwdEtleVdpdGhWZXJzaW9uZWRLZXkodXNlckdyb3VwS2V5LCB0dXRhbm90YVByb3BlcnRpZXNTZXNzaW9uS2V5KVxuXHRcdGNvbnN0IHVzZXJFbmNFbnRyb3B5ID0gZW5jcnlwdEJ5dGVzKHVzZXJHcm91cEtleS5vYmplY3QsIHJhbmRvbS5nZW5lcmF0ZVJhbmRvbURhdGEoMzIpKVxuXG5cdFx0Y29uc3QgY3VzdG9tZXJFbmNNYWlsR3JvdXBJbmZvU2Vzc2lvbktleSA9IGVuY3J5cHRLZXlXaXRoVmVyc2lvbmVkS2V5KGN1c3RvbWVyR3JvdXBLZXksIG1haWxHcm91cEluZm9TZXNzaW9uS2V5KVxuXHRcdGNvbnN0IGN1c3RvbWVyRW5jQ29udGFjdEdyb3VwSW5mb1Nlc3Npb25LZXkgPSBlbmNyeXB0S2V5V2l0aFZlcnNpb25lZEtleShjdXN0b21lckdyb3VwS2V5LCBjb250YWN0R3JvdXBJbmZvU2Vzc2lvbktleSlcblx0XHRjb25zdCBjdXN0b21lckVuY0ZpbGVHcm91cEluZm9TZXNzaW9uS2V5ID0gZW5jcnlwdEtleVdpdGhWZXJzaW9uZWRLZXkoY3VzdG9tZXJHcm91cEtleSwgZmlsZUdyb3VwSW5mb1Nlc3Npb25LZXkpXG5cblx0XHRjb25zdCBjb250YWN0RW5jQ29udGFjdExpc3RTZXNzaW9uS2V5ID0gZW5jcnlwdEtleVdpdGhWZXJzaW9uZWRLZXkoY29udGFjdEdyb3VwS2V5LCBjb250YWN0TGlzdFNlc3Npb25LZXkpXG5cdFx0Y29uc3QgZmlsZUVuY0ZpbGVTeXN0ZW1TZXNzaW9uS2V5ID0gZW5jcnlwdEtleVdpdGhWZXJzaW9uZWRLZXkoZmlsZUdyb3VwS2V5LCBmaWxlU3lzdGVtU2Vzc2lvbktleSlcblx0XHRjb25zdCBtYWlsRW5jTWFpbEJveFNlc3Npb25LZXkgPSBlbmNyeXB0S2V5V2l0aFZlcnNpb25lZEtleShtYWlsR3JvdXBLZXksIG1haWxib3hTZXNzaW9uS2V5KVxuXG5cdFx0cmV0dXJuIGNyZWF0ZVVzZXJBY2NvdW50VXNlckRhdGEoe1xuXHRcdFx0bWFpbEFkZHJlc3M6IG1haWxBZGRyZXNzLFxuXHRcdFx0ZW5jcnlwdGVkTmFtZTogZW5jcnlwdFN0cmluZyh1c2VyR3JvdXBJbmZvU2Vzc2lvbktleSwgdXNlck5hbWUpLFxuXHRcdFx0c2FsdDogc2FsdCxcblx0XHRcdGtkZlZlcnNpb246IGtkZlR5cGUsXG5cblx0XHRcdHZlcmlmaWVyOiBjcmVhdGVBdXRoVmVyaWZpZXIodXNlclBhc3NwaHJhc2VLZXkpLFxuXHRcdFx0cHdFbmNVc2VyR3JvdXBLZXk6IGVuY3J5cHRLZXkodXNlclBhc3NwaHJhc2VLZXksIHVzZXJHcm91cEtleS5vYmplY3QpLFxuXG5cdFx0XHR1c2VyRW5jQ3VzdG9tZXJHcm91cEtleTogdXNlckVuY0N1c3RvbWVyR3JvdXBLZXkua2V5LFxuXHRcdFx0dXNlckVuY01haWxHcm91cEtleTogdXNlckVuY01haWxHcm91cEtleS5rZXksXG5cdFx0XHR1c2VyRW5jQ29udGFjdEdyb3VwS2V5OiB1c2VyRW5jQ29udGFjdEdyb3VwS2V5LmtleSxcblx0XHRcdHVzZXJFbmNGaWxlR3JvdXBLZXk6IHVzZXJFbmNGaWxlR3JvdXBLZXkua2V5LFxuXHRcdFx0dXNlckVuY0VudHJvcHk6IHVzZXJFbmNFbnRyb3B5LFxuXHRcdFx0dXNlckVuY1R1dGFub3RhUHJvcGVydGllc1Nlc3Npb25LZXk6IHVzZXJFbmNUdXRhbm90YVByb3BlcnRpZXNTZXNzaW9uS2V5LmtleSxcblxuXHRcdFx0Y29udGFjdEVuY0NvbnRhY3RMaXN0U2Vzc2lvbktleTogY29udGFjdEVuY0NvbnRhY3RMaXN0U2Vzc2lvbktleS5rZXksXG5cblx0XHRcdGZpbGVFbmNGaWxlU3lzdGVtU2Vzc2lvbktleTogZmlsZUVuY0ZpbGVTeXN0ZW1TZXNzaW9uS2V5LmtleSxcblxuXHRcdFx0bWFpbEVuY01haWxCb3hTZXNzaW9uS2V5OiBtYWlsRW5jTWFpbEJveFNlc3Npb25LZXkua2V5LFxuXG5cdFx0XHRjdXN0b21lckVuY01haWxHcm91cEluZm9TZXNzaW9uS2V5OiBjdXN0b21lckVuY01haWxHcm91cEluZm9TZXNzaW9uS2V5LmtleSxcblx0XHRcdGN1c3RvbWVyRW5jQ29udGFjdEdyb3VwSW5mb1Nlc3Npb25LZXk6IGN1c3RvbWVyRW5jQ29udGFjdEdyb3VwSW5mb1Nlc3Npb25LZXkua2V5LFxuXHRcdFx0Y3VzdG9tZXJFbmNGaWxlR3JvdXBJbmZvU2Vzc2lvbktleTogY3VzdG9tZXJFbmNGaWxlR3JvdXBJbmZvU2Vzc2lvbktleS5rZXksXG5cdFx0XHRjdXN0b21lcktleVZlcnNpb246IGN1c3RvbWVyRW5jQ29udGFjdEdyb3VwSW5mb1Nlc3Npb25LZXkuZW5jcnlwdGluZ0tleVZlcnNpb24udG9TdHJpbmcoKSxcblxuXHRcdFx0cmVjb3ZlckNvZGVFbmNVc2VyR3JvdXBLZXk6IHJlY292ZXJEYXRhLnJlY292ZXJDb2RlRW5jVXNlckdyb3VwS2V5LFxuXHRcdFx0cmVjb3ZlckNvZGVWZXJpZmllcjogcmVjb3ZlckRhdGEucmVjb3ZlcnlDb2RlVmVyaWZpZXIsXG5cdFx0XHR1c2VyRW5jUmVjb3ZlckNvZGU6IHJlY292ZXJEYXRhLnVzZXJFbmNSZWNvdmVyQ29kZSxcblx0XHR9KVxuXHR9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBc0JBLG9CQUFvQjtJQUVQLHVCQUFOLE1BQTJCO0NBQ2pDLFlBQ2tCQSxZQUNBQyxpQkFDQUMsVUFDQUMsY0FDQUMsaUJBQ0FDLDBCQUNBQyxhQUNBQyxVQUNBQyxpQkFDQUMsbUJBQ2hCO0VBMk1GLEtBck5rQjtFQXFOakIsS0FwTmlCO0VBb05oQixLQW5OZ0I7RUFtTmYsS0FsTmU7RUFrTmQsS0FqTmM7RUFpTmIsS0FoTmE7RUFnTlosS0EvTVk7RUErTVgsS0E5TVc7RUE4TVYsS0E3TVU7RUE2TVQsS0E1TVM7Q0FDZDtDQUVKLE1B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